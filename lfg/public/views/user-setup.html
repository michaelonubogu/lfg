<link rel="import" href="../components/bower_components/polymer/polymer.html">
<link rel="import" href="../imports/layout.html">

<!-- Fonts -->
<link rel='import' href='../components/bower_components/font-roboto/roboto.html'>

<link rel="import" href="../components/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/av-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/hardware-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/image-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/notification-icons.html">
<link rel="import" href="../components/bower_components/iron-icons/social-icons.html">

<link rel="import" href="../components/bower_components/iron-form/iron-form.html">

<link rel="import" href="../components/bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../components/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../components/bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../components/bower_components/paper-item/paper-item.html">
<link rel="import" href="../components/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../components/bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../components/bower_components/paper-toolbar/paper-toolbar.html">

<!-- Custom Imports -->
<link rel="import" href="../imports/font-awesome.html">
<link rel="import" href="../imports/materialize.html" />
<link rel="import" href="../imports/material_icons.html" />
<link rel="import" href="../imports/flaticons.html" />
<!--<link rel="import" href="../imports/crypto-js.html" />-->


<dom-module id="user-setup">
	<!-- CSS -->
	<link rel="import" type="css" href='../assets/app/css/lfg.css'>

	<style>
		:host {
			
		}

		.profile-background {
			background-color: transparent;
			background:url('../assets/app/img/1662530.jpg');
			background-size:cover;
			border-bottom:solid 1px #ffee58;
		}

		.profile-overlay{  
			background:rgba(0,0,0,.5);
            text-align:center;
            padding:45px 0 66px 0;
            opacity:0;
            -webkit-transition: opacity .25s ease;
			-moz-transition: opacity .25s ease;
			 opacity:1;
			 height: 100%;
			 width: 100%;
		}

		.content-area{
			/*margin-top:3%;*/
			padding:0 3% 0 3%;
            background-color:#fb8c00;
        }

		#done-button.btn:hover, #done-button.btn-large:hover {
			background-color: #1b5e20;
		}

		.sign-in-flaticon-update {
			font-size: 50px !important;
			color: #ffffff;
			margin-top: -15px;
		}

		.regular-text {
			text-transform: none;
		}

		.sign-in-button {
			width: 300px;
		}
		.lfg-input{
            color: #e65100 !important;
        }

		.lfg-input.input-field textarea {
			border-bottom: 1px solid transparent;
            box-shadow: 0 1px 0 0 transparent;
		}

		.lfg-input.input-field textarea:focus {
			border-bottom: 1px solid transparent;
            box-shadow: 0 1px 0 0 transparent;
		}

        /* label color */
        .lfg-input.input-field label {
            color: #e65100;
        }

        .lfg-input.input-field input[type=text]{
            border-bottom: 1px solid transparent;
            box-shadow: 0 1px 0 0 transparent;
            font-size: 1.5rem;
        }

		.lfg-input.input-field input[type=email]{
            border-bottom: 1px solid transparent;
            box-shadow: 0 1px 0 0 transparent;
            font-size: 1.5rem;
        }

        /* label focus color */
        .lfg-input.input-field input[type=text]:focus + label {
            color: #e65100;
        }

		.lfg-input.input-field input[type=email]:focus + label {
            color: #e65100;
        }

        /* label underline focus color */
        .lfg-input.input-field input[type=text]:focus {
            border-bottom: 1px solid transparent;
            box-shadow: 0 1px 0 0 transparent;
        }

		.lfg-input.input-field input[type=email]:focus {
            border-bottom: 1px solid transparent;
            box-shadow: 0 1px 0 0 transparent;
        }
        /* valid color */
        .lfg-input.input-field input[type=text].valid {
            border-bottom: 1px solid transparent;
            box-shadow: 0 1px 0 0 transparent;
        }

		.lfg-input.input-field input[type=email].valid {
            border-bottom: 1px solid transparent;
            box-shadow: 0 1px 0 0 transparent;
        }

        /* invalid color */
        .lfg-input.input-field input[type=text].invalid {
            border-bottom: 1px solid transparent !important;
            box-shadow: 0 1px 0 0 transparent !important;
        }

		.lfg-input.input-field input[type=email].invalid {
            border-bottom: 1px solid transparent !important;
            box-shadow: 0 1px 0 0 transparent !important;
        }

		.lfg-input .select-wrapper input.select-dropdown .invalid {
			border-bottom: 1px solid #f44336 !important;
            box-shadow: 0 1px 0 0 #f44336 !important;
		}

        /* Icon prefix */
        .lfg-input.input-field .prefix {
            color: #e65100;
        }

        /* icon prefix focus color */
        .lfg-input.input-field .prefix.active {
            color: #e65100;
        }

		.lfg-input .select-wrapper input.select-dropdown{
			border-bottom: 1px solid #ffffff;
            box-shadow: 0 1px 0 0 #ffffff;
		}

		.requests-card-panel{
            width: 100%;
            box-shadow: 0 2px 5px 0 #e65100;
            border-radius:0px;
            padding:0px;
			margin-top:40px;
        }

		.collection-modified li {
			padding-left: 20px !important;
		}

		.collection-modified li i {
			font-size:3rem;
			color:#e65100;
			margin-top: 15px;
		}

		.wizard-header {
			text-shadow: 0px 2px 2px #8c9eff;
		}

		.wizard-input.row {
			margin-bottom: 0 !important;
			margin-top: 0 !important;
			line-height: 1;
		}

	</style>

	<template>
		<div class="profile-background" layout vertical center style="height:60vh;">
			<div class="profile-overlay">
				<div layout horizontal center-justified style="opacity:1.0 !important; z-index:1000;">
					<div layout no-wrap style="visibility:hidden;">
						<a class="btn-flat white-text">
							<i class="material-icons white-text left">arrow_back</i>
							Back
						</a>
					</div>
					<div flex></div>
					<div self-center class="col s6 center"><h6 class="white-text thin" style="font-size:1.2rem;">Enter your Username & Email, and upload a profile picture</h6></div>
					<div flex></div>
					<div layout no-wrap>
						<a class="btn-flat white-text waves-effect waves-light thin">
							<i class="material-icons white-text right thin">arrow_forward</i>
							Next
						</a>
					</div>
				</div>
				<div class="row" style="margin-top: 50px; opacity:1.0 !important; z-index:1000;">
					<div class="col s12 center center-aligned">
						<img id="profile_pic" src="../assets/app/img/profile-photo-placeholder.jpg" alt="" class="circle responsive-img" style="border:solid 2px #ffffff; height:125px; width:125px;">
					</div>
					<div class="col s12 center" style="margin-top:-10px;">
						<h4 class="light white-text" style="font-size:1.35rem;">{{user.username}}</h4>
					</div>
					
					<div class="lfg-input input-field col s12 center" layout center style="margin-top:40px;">
						<div class="file-field" layout horizontal center-center>
							<div class="btn center center-aligned orange darken-4">
								<span><i class="material-icons left">backup</i> Upload your Pic</span>
								<input id="file_upload" type="file" accept="image/*" capture="camera" />
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="container content-area">
			<div class="card-panel requests-card-panel">
				<ul class="collection collection-modified">
					<li class="collection-item avatar">
						<div class="wizard-input row">
							<div class="col s2"><i class="material-icons prefix">account_circle</i></div>
							<div class="lfg-input input-field col s10">
								<input id="username" placeholder="Username" type="text" class="validate" on-keyup="changeUsername" />
							</div>
						</div>
					</li>
					<li class="collection-item avatar">
						<div class="row">
							<div class="col s2"><i class="material-icons prefix">email</i></div>
							<div class="lfg-input input-field col s10">
								<input id="email" placeholder="Email (No spam! We promise)" type="text" class="validate" value="{{user.email}}" />
							</div>
						</div>
					</li>
				</ul>
			</div>

			<!--<form id="new_request_form" class="col s12">
				<div class="row">
					<div class="lfg-input input-field col s12">
						<input id="username" type="text" class="validate" on-keyup="changeUsername" />
						<label for="username">Username</label>
					</div>
				</div>
				<br />
				<div class="row">
					<div class="lfg-input input-field col s12">
						<input id="email" type="text" class="validate" value="{{user.email}}"/>
						<label for="email">Email (We promise, we won't spam your inbox)</label>
					</div>
				</div>
				<br />
				<div class="row">
					<div class="col s12 center">
						<label class="white-text" style="font-size:1rem;">Upload a profle pic, so everyone can see just how cool you look.</label>
					</div>
					<div class="lfg-input input-field col s12 center" layout center>
						<div class="file-field" layout horizontal center-center>
							<div class="btn center center-aligned orange darken-4">
								<span><i class="material-icons left">backup</i> Upload</span>
								<input id="file_upload" type="file" accept="image/*" capture="camera" />
							</div>
						</div>
					</div>
				</div>
				<br />
				<div class="row">
					<div class="col s12"  layout horizontal center-center>
						<a id="done-button" on-click="saveUserData" class="btn btn-flat btn-large waves-effect waves-light white-text" style="font-size:1.75rem;">
							<i class="material-icons left" style="font-size:2.3rem;">done</i>
							Done
						</a>
					</div>
				</div>
			</form>-->
		</div>
	</template>
</dom-module>

<script>
    (function(window) {
        var constructor = Polymer({

        	is: 'user-setup',

            /**
             * ...
             *
             * @attribute properties
             * @type object
             * @default
             */
            properties: {
            	name: 'User Setup'
            },

        	/* Functions */
            validateInput: function (userdata) {
            	var valid = true;

            	if (userdata.username === null || userdata.username === undefined || userdata.username === '') {
            		valid = false;
            	}

            	if (userdata.email === null || userdata.email === undefined || userdata.email === '' || !window.lfg.utils.checkEmail(userdata.email)) {
            		valid = false;
            	}

            	if (userdata.profilepic === null || userdata.profilepic === undefined) {
            		valid = false;
            	}
            	return valid;
            },

			/* Init */
            initializeData: function () {

            	this.user = {
            		username: "(What we'll call you)",
            		email: ''
            	};

            	this.firebaseUrl = window.lfg.config.getFirebaseUrl();
            	this.firebaseRef = new Firebase(window.lfg.config.getFirebaseUrl());
            },

            registerEvents: function () {
            	document.getElementById("file_upload").addEventListener('change', this.handleFileSelect.bind(this), false);
            	$(this.$.username).focus();
            },

            registerPlugins: function() {
            },

        	/* Events */
            changeUsername: function (e) {
            	//Despite how awesome Polymer 1.0 is, sometimes, you find some really annoying bugs in it - not complaining though
				//It's not "data-binding" if I have to "manually" set the property to persist it's value. This should be automatic!!!!!!!
            	var input = e.target;
            	this.set('user.username', input.value);
            },

            handleFileSelect: function (evt) {
            	//Thank you firepano over @ https://github.com/firebase/firepano
            	var cusElem = this;
            	var f = evt.target.files[0];
            	var reader = new FileReader();
            	reader.onload = (function (theFile) {
            		return function (e) {
            			var filePayload = e.target.result;
            			cusElem.user.profilepic = filePayload;
            			document.getElementById("profile_pic").src = e.target.result;
            			//$(cusElem.$.file_upload).hide();

            			// Generate a location that can't be guessed using the file's contents and a random number
            			//var hash = CryptoJS.SHA256(Math.random() + CryptoJS.SHA256(filePayload));

            			//var f = new Firebase(firebaseRef + 'pano/' + hash + '/filePayload');
            			//spinner.spin(document.getElementById('spin'));

            			// Set the file payload to Firebase and register an onComplete handler to stop the spinner and show the preview
            			//f.set(filePayload, function () {
            			//	spinner.stop();
            			//	document.getElementById("pano").src = e.target.result;
            			//	$('#file-upload').hide();
            			//	// Update the location bar so the URL can be shared with others
            			//	window.location.hash = hash;
            			//});
            		};
            	})(f);
            	reader.readAsDataURL(f);
            },

            saveUserData: function () {
            	//do some validation...
            	if (this.validateInput(this.user)) {
            		var authData = sessionStorage.getItem('authData');
            		var userRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + authData.uid);
            		userRef.setvalue(this.user);
            	}
            },

            ready: function () {
            	this.initializeData();
            },

            attached: function () {
            	this.registerPlugins();
            	this.registerEvents();
            }
        });
    })(window);
</script>